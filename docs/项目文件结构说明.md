# TechPulse 项目文件结构详细说明

> 本文档详细说明 TechPulse 项目的前后端文件结构，帮助开发者快速理解项目架构。
>
> **版本**: 0.2.1
> **更新日期**: 2025-10-21

---

## 目录

- [1. 项目整体结构](#1-项目整体结构)
- [2. 后端结构 (Backend)](#2-后端结构-backend)
- [3. 前端结构 (Frontend)](#3-前端结构-frontend)
- [4. 其他目录](#4-其他目录)

---

## 1. 项目整体结构

```
TechPulse/
├── backend/              # 后端应用 (FastAPI + Python)
├── frontend/             # 前端应用 (React + TypeScript + Electron)
├── docs/                 # 项目文档
├── scripts/              # 辅助脚本
└── .git/                 # Git 版本控制
```

---

## 2. 后端结构 (Backend)

### 2.1 技术栈

- **框架**: FastAPI (异步 Python Web 框架)
- **数据库**: SQLAlchemy ORM + SQLite
- **认证**: JWT + OAuth2 (Google, GitHub, Microsoft)
- **AI/ML**: Azure OpenAI
- **任务调度**: APScheduler
- **数据迁移**: Alembic

### 2.2 目录结构

```
backend/
├── app/                        # 主应用代码目录
│   ├── __init__.py
│   ├── main.py                # 【核心】FastAPI 应用入口，路由注册，CORS配置
│   │
│   ├── core/                  # 核心配置和基础设施
│   │   ├── config.py          # 环境变量配置、JWT配置、OAuth配置、数据库URL
│   │   ├── database.py        # SQLAlchemy 引擎、会话管理
│   │   ├── security.py        # JWT生成/验证、密码加密(Argon2/Bcrypt)
│   │   ├── security_enhanced.py # 2FA、邮箱验证、密码重置
│   │   ├── email.py           # SMTP 邮件服务
│   │   └── version.py         # 版本管理
│   │
│   ├── models/                # 数据模型层
│   │   ├── user.py            # User 用户模型 (id, username, email, password等)
│   │   ├── card.py            # TechCard 技术卡片 (标题、来源、URL、摘要、标签)
│   │   ├── auth_log.py        # 认证日志 (登录记录、IP追踪)
│   │   ├── behavior.py        # 用户行为追踪
│   │   ├── user_interaction.py      # 用户交互记录 (点击、查看、分享)
│   │   ├── user_preference.py       # 用户偏好设置 (标签、来源偏好)
│   │   ├── user_collection.py       # 用户收藏
│   │   ├── user_favorite.py         # 用户收藏夹
│   │   ├── recommendation_history.py # 推荐历史
│   │   ├── user_settings.py         # 用户设置 (语言、主题、通知)
│   │   ├── config.py                # 系统配置模型
│   │   ├── llm_provider.py          # LLM 提供商配置
│   │   ├── schemas.py               # Pydantic Schema 基础模型
│   │   ├── user_schemas.py          # 用户相关 Schema (注册、登录、响应)
│   │   └── llm_schemas.py           # LLM 相关 Schema
│   │
│   ├── api/                   # API 路由层 (20个路由文件)
│   │   ├── auth.py            # 基础认证 (注册、登录、刷新token)
│   │   ├── auth_enhanced.py   # 增强认证 (2FA、邮箱验证、密码重置)
│   │   ├── oauth.py           # OAuth2 集成 (Google, GitHub, Microsoft)
│   │   ├── cards.py           # 技术卡片管理 (CRUD、过滤、排序)
│   │   ├── sources.py         # 数据源管理 (GitHub、Arxiv、HuggingFace、Zenn)
│   │   ├── search.py          # 智能搜索 (关键词、标签、来源)
│   │   ├── recommend.py       # 推荐系统 (基于用户偏好)
│   │   ├── health.py          # 系统健康检查
│   │   ├── ai.py              # AI 总体功能
│   │   ├── ai_config.py       # AI 配置管理
│   │   ├── chat.py            # 聊天功能
│   │   ├── llm_providers.py   # LLM 提供商管理
│   │   ├── user_settings.py   # 用户设置管理
│   │   ├── settings.py        # 应用设置
│   │   ├── preferences.py     # 用户偏好
│   │   ├── behavior.py        # 行为追踪
│   │   ├── translate.py       # 翻译功能
│   │   ├── notion.py          # Notion 集成
│   │   └── system_config.py   # 系统配置管理
│   │
│   ├── services/              # 业务逻辑层
│   │   ├── data_collector.py  # 【核心】从各数据源爬取数据 (异步收集)
│   │   ├── config_manager.py  # 配置管理服务
│   │   ├── notion.py          # Notion API 集成
│   │   ├── quality_filter.py  # 数据质量评分和过滤
│   │   ├── scheduler.py       # 【核心】任务调度器 (每6小时自动收集数据)
│   │   │
│   │   ├── ai/                # AI 子服务
│   │   │   ├── azure_openai.py    # Azure OpenAI 服务
│   │   │   ├── summarizer.py      # 文本摘要服务
│   │   │   └── config_helper.py   # AI 配置辅助
│   │   │
│   │   └── scrapers/          # 数据爬虫
│   │       ├── github.py      # GitHub 仓库爬虫 (热门项目、趋势)
│   │       ├── arxiv.py       # Arxiv 论文爬虫 (最新研究)
│   │       ├── huggingface.py # Hugging Face 模型爬虫
│   │       └── zenn.py        # Zenn 技术文章爬虫
│   │
│   └── utils/                 # 工具函数
│
├── alembic/                   # 数据库迁移管理
│   ├── env.py                 # 迁移环境配置
│   ├── script.py.mako         # 迁移脚本模板
│   └── versions/              # 迁移历史文件
│       ├── 8b08b1d96d72_initial_migration.py
│       └── 872586777ad8_add_zenn_source_type.py
│
├── tests/                     # 测试目录
│   ├── conftest.py            # Pytest 配置和 fixtures
│   ├── unit/                  # 单元测试
│   │   ├── test_security.py
│   │   ├── test_card_model.py
│   │   ├── test_config_manager.py
│   │   ├── test_ai_config_validation.py
│   │   ├── test_search.py
│   │   └── test_recommend.py
│   │
│   └── integration/           # 集成测试
│       ├── test_auth_api.py
│       ├── test_cards_api.py
│       ├── test_recommend_api.py
│       ├── test_search_api.py
│       └── test_system_config_api.py
│
├── scripts/                   # 辅助脚本
│   ├── run_tests.sh           # 运行测试脚本
│   ├── create_personalization_tables.py  # 创建个性化表格
│   ├── create_settings_tables.py         # 创建设置表格
│   ├── migrate_auth_enhancements.py      # 认证增强迁移
│   └── rescore_all_cards.py              # 重新评分所有卡片
│
├── pyproject.toml             # Poetry 依赖配置
├── pytest.ini                 # Pytest 配置
├── alembic.ini                # Alembic 数据库迁移配置
├── run.py                     # 【启动】后端启动脚本
└── techpulse.db               # SQLite 数据库文件
```

### 2.3 核心工作流程

1. **应用启动** (`main.py`):
   - 初始化 FastAPI 应用
   - 配置 CORS 中间件
   - 注册所有路由
   - 启动任务调度器 (`scheduler.py`)

2. **数据收集流程** (`services/data_collector.py` + `services/scheduler.py`):
   - 每 6 小时自动触发
   - 并发从 GitHub、Arxiv、Hugging Face、Zenn 爬取数据
   - 质量评分和过滤 (`services/quality_filter.py`)
   - 存储到数据库 (`models/card.py`)

3. **认证流程** (`api/auth.py` + `core/security.py`):
   - 用户注册/登录
   - JWT Token 生成 (access + refresh)
   - OAuth2 登录 (Google, GitHub, Microsoft)
   - 2FA/邮箱验证 (`api/auth_enhanced.py`)

4. **推荐流程** (`api/recommend.py`):
   - 读取用户偏好 (`models/user_preference.py`)
   - 基于标签、来源、历史行为推荐
   - 记录推荐历史 (`models/recommendation_history.py`)

### 2.4 数据库表格

| 表名 | 说明 |
|------|------|
| `users` | 用户信息和认证 |
| `tech_cards` | 技术卡片 (内容、标签、质量评分) |
| `auth_logs` | 认证日志 (登录记录、IP) |
| `user_interactions` | 用户交互 (点击、查看) |
| `user_preferences` | 用户偏好 (标签、来源) |
| `user_collections` | 用户收藏 |
| `user_favorites` | 用户收藏夹 |
| `recommendation_history` | 推荐历史 |
| `user_settings` | 用户设置 (语言、主题) |
| `data_source_health` | 数据源健康状态 |
| `llm_provider` | LLM 提供商配置 |

### 2.5 API 端点概览

**Base URL**: `/api/v1/`

| 路由 | 说明 |
|------|------|
| `/auth/*` | 认证操作 (注册、登录、刷新) |
| `/oauth/*` | OAuth2 登录 |
| `/cards/*` | 卡片管理 (CRUD、过滤) |
| `/sources/*` | 数据源管理 |
| `/search/*` | 智能搜索 |
| `/recommend/*` | 推荐系统 |
| `/ai/*` | AI 功能 |
| `/chat/*` | 聊天服务 |
| `/preferences/*` | 用户偏好 |
| `/user-settings/*` | 用户设置 |
| `/health/*` | 系统健康检查 |

---

## 3. 前端结构 (Frontend)

### 3.1 技术栈

- **框架**: React 18.2.0 (函数式组件 + Hooks)
- **语言**: TypeScript 5.2.2
- **构建工具**: Vite 4.5.0
- **桌面支持**: Electron (跨平台桌面应用)
- **UI 库**: Ant Design 5.11.0 (企业级组件库)
- **状态管理**:
  - React Query 5.90.2 (服务端状态缓存)
  - Zustand 4.4.6 (轻量级全局状态)
  - Context API (多语言状态)
- **数据可视化**:
  - ECharts 5.6.0 (高级图表)
  - Ant Design Charts 2.6.5
- **HTTP 客户端**: Axios (带拦截器)

### 3.2 目录结构 (详细解释)

```
frontend/
├── src/                          # 源代码目录
│   ├── main.tsx                  # 【入口】React 应用挂载点
│   │                             # 作用: ReactDOM.render(<App />, root)
│   │
│   ├── App.tsx                   # 【核心】应用主组件 (450行)
│   │                             # 作用: 路由配置、全局布局、导航、认证检查
│   │                             # 包含: React Router 路由、侧边栏导航、顶部栏
│   │
│   ├── index.css                 # 全局样式
│   │                             # 作用: 重置样式、全局字体、颜色变量
│   │
│   ├── vite-env.d.ts             # Vite 类型声明
│   │                             # 作用: 让 TypeScript 识别 Vite 环境变量
│   │
│   ├── pages/                    # 【页面组件】18个页面 (对应路由)
│   │   │
│   │   ├── HomePage.tsx          # 首页 (展示最新技术卡片)
│   │   │                         # 路由: /
│   │   │                         # 功能: 卡片列表、过滤、排序、分页
│   │   │
│   │   ├── Login.tsx             # 登录页
│   │   │                         # 路由: /login
│   │   │                         # 功能: 用户名/密码登录、OAuth登录、记住我
│   │   │
│   │   ├── Register.tsx          # 注册页
│   │   │                         # 路由: /register
│   │   │                         # 功能: 用户注册表单、验证、跳转登录
│   │   │
│   │   ├── InterestSurvey.tsx    # 兴趣调查页
│   │   │                         # 路由: /interest-survey
│   │   │                         # 功能: 新用户选择感兴趣的标签和来源
│   │   │
│   │   ├── Dashboard.tsx         # 仪表盘 (数据统计可视化)
│   │   │                         # 路由: /dashboard
│   │   │                         # 功能: 图表展示 (卡片数量、来源分布、趋势)
│   │   │
│   │   ├── DataSources.tsx       # 数据源管理页
│   │   │                         # 路由: /data-sources
│   │   │                         # 功能: 查看/配置 GitHub、Arxiv、HuggingFace、Zenn
│   │   │
│   │   ├── Analytics.tsx         # 分析页 (高级数据分析)
│   │   │                         # 路由: /analytics
│   │   │                         # 功能: 用户行为分析、推荐效果分析
│   │   │
│   │   ├── SearchPage.tsx        # 搜索页
│   │   │                         # 路由: /search
│   │   │                         # 功能: 关键词搜索、高级筛选、搜索结果展示
│   │   │
│   │   ├── RecommendPage.tsx     # 推荐页
│   │   │                         # 路由: /recommend
│   │   │                         # 功能: 个性化推荐卡片、基于用户偏好
│   │   │
│   │   ├── Collections.tsx       # 收藏页
│   │   │                         # 路由: /collections
│   │   │                         # 功能: 用户收藏的卡片列表、管理收藏夹
│   │   │
│   │   ├── Settings.tsx          # 设置页 (用户设置)
│   │   │                         # 路由: /settings
│   │   │                         # 功能: 语言、主题、通知、个人信息
│   │   │
│   │   ├── SystemManagement/     # 【系统管理】子目录 (管理员功能)
│   │   │   │
│   │   │   ├── SystemSettings.tsx     # 系统设置页
│   │   │   │                          # 路由: /system-management/settings
│   │   │   │                          # 功能: 全局系统配置、管理员设置
│   │   │   │
│   │   │   ├── LLMProviders.tsx       # LLM 提供商管理页
│   │   │   │                          # 路由: /system-management/llm-providers
│   │   │   │                          # 功能: 配置 OpenAI、Azure、Ollama等
│   │   │   │
│   │   │   ├── Tasks.tsx              # 任务管理页
│   │   │   │                          # 路由: /system-management/tasks
│   │   │   │                          # 功能: 查看/管理后台任务、调度器状态
│   │   │   │
│   │   │   ├── UserManagement.tsx     # 用户管理页
│   │   │   │                          # 路由: /system-management/users
│   │   │   │                          # 功能: 管理用户、权限、删除用户
│   │   │   │
│   │   │   └── NotionIntegration.tsx  # Notion 集成页
│   │   │                              # 路由: /system-management/notion
│   │   │                              # 功能: 配置 Notion API、同步设置
│   │   │
│   │   └── NotFound.tsx          # 404 页面
│   │                             # 路由: *
│   │                             # 功能: 显示页面不存在提示
│   │
│   ├── components/               # 【可复用组件】13个组件
│   │   │
│   │   ├── Layout.tsx            # 布局组件 (页面框架)
│   │   │                         # 作用: 包含侧边栏、顶部栏、内容区域
│   │   │                         # 使用: 在 App.tsx 中包裹所有页面
│   │   │
│   │   ├── Navbar.tsx            # 导航栏组件
│   │   │                         # 作用: 顶部导航、用户菜单、语言切换
│   │   │                         # 位置: 固定在页面顶部
│   │   │
│   │   ├── Sidebar.tsx           # 侧边栏组件
│   │   │                         # 作用: 左侧菜单、路由导航
│   │   │                         # 功能: 可折叠、高亮当前路由
│   │   │
│   │   ├── TechCard.tsx          # 技术卡片组件
│   │   │                         # 作用: 展示单个技术卡片 (标题、摘要、标签、来源)
│   │   │                         # 使用: 在首页、搜索页、推荐页
│   │   │
│   │   ├── SearchBar.tsx         # 搜索框组件
│   │   │                         # 作用: 关键词搜索、自动完成
│   │   │                         # 使用: 顶部导航、搜索页
│   │   │
│   │   ├── FilterPanel.tsx       # 过滤面板组件
│   │   │                         # 作用: 按来源、标签、日期过滤
│   │   │                         # 使用: 首页、搜索页
│   │   │
│   │   ├── TagCloud.tsx          # 标签云组件
│   │   │                         # 作用: 可视化展示热门标签
│   │   │                         # 使用: 首页、兴趣调查页
│   │   │
│   │   ├── RecommendationList.tsx # 推荐列表组件
│   │   │                         # 作用: 展示推荐的技术卡片
│   │   │                         # 使用: 推荐页、首页侧边栏
│   │   │
│   │   ├── UserProfile.tsx       # 用户资料组件
│   │   │                         # 作用: 展示用户头像、信息、统计
│   │   │                         # 使用: 设置页、个人中心
│   │   │
│   │   ├── NotificationCenter.tsx # 通知中心组件
│   │   │                         # 作用: 展示系统通知、消息
│   │   │                         # 使用: 顶部导航下拉
│   │   │
│   │   ├── LoadingSkeleton.tsx   # 加载骨架屏组件
│   │   │                         # 作用: 数据加载时的占位动画
│   │   │                         # 使用: 所有需要加载数据的页面
│   │   │
│   │   ├── ErrorBoundary.tsx     # 错误边界组件
│   │   │                         # 作用: 捕获子组件错误、展示错误页面
│   │   │                         # 使用: App.tsx 包裹整个应用
│   │   │
│   │   └── PrivateRoute.tsx      # 私有路由组件
│   │                             # 作用: 保护需要登录的页面
│   │                             # 使用: App.tsx 路由配置
│   │
│   ├── services/                 # 【API 服务层】与后端通信
│   │   │
│   │   ├── llmService.ts         # LLM 服务
│   │   │                         # 作用: 调用 /api/v1/llm-providers/* 接口
│   │   │                         # 方法: getLLMProviders(), updateProvider(), testConnection()
│   │   │
│   │   ├── systemConfigService.ts # 系统配置服务
│   │   │                         # 作用: 调用 /api/v1/system-config/* 接口
│   │   │                         # 方法: getConfig(), updateConfig(), validateConfig()
│   │   │
│   │   └── userSettingsService.ts # 用户设置服务
│   │                             # 作用: 调用 /api/v1/user-settings/* 接口
│   │                             # 方法: getUserSettings(), updateSettings()
│   │
│   ├── utils/                    # 【工具函数】
│   │   │
│   │   └── api.ts                # 【核心】Axios 实例配置
│   │                             # 作用:
│   │                             # 1. 创建 Axios 实例 (baseURL: /api/v1)
│   │                             # 2. 请求拦截器 (自动添加 JWT Token)
│   │                             # 3. 响应拦截器 (处理错误、自动刷新 Token)
│   │                             # 4. 401 错误自动跳转登录
│   │                             # 使用: 所有 API 调用的基础
│   │
│   ├── contexts/                 # 【React Context】全局状态
│   │   │
│   │   └── LanguageContext.tsx   # 多语言上下文
│   │                             # 作用: 管理当前语言 (中文、英文、日文)
│   │                             # 提供: language, setLanguage, t() 翻译函数
│   │                             # 使用: 所有组件通过 useLanguage() Hook 访问
│   │
│   ├── hooks/                    # 【自定义 Hooks】
│   │   │
│   │   └── useCards.ts           # 技术卡片数据 Hook
│   │                             # 作用: 使用 React Query 获取卡片数据
│   │                             # 方法: useCards(), useCardDetail(), useCreateCard()
│   │                             # 功能: 自动缓存、自动重新获取、加载状态
│   │
│   ├── locales/                  # 【国际化】
│   │   │
│   │   └── translations.ts       # 翻译文件
│   │                             # 作用: 存储所有界面文本的三语言翻译
│   │                             # 语言: zh-CN (中文), en-US (英文), ja-JP (日文)
│   │                             # 结构: { 'home.title': { 'zh-CN': '首页', 'en-US': 'Home', ... } }
│   │
│   ├── types/                    # 【TypeScript 类型定义】
│   │   │
│   │   └── card.ts               # 卡片数据类型
│   │                             # 作用: 定义 TechCard 接口
│   │                             # 内容: id, title, source, url, summary, tags, quality_score 等
│   │
│   └── lib/                      # 【第三方库配置】
│       │
│       └── queryClient.ts        # React Query 客户端配置
│                                 # 作用: 配置缓存策略、重试策略、默认选项
│                                 # 使用: 在 main.tsx 中提供给整个应用
│
├── public/                       # 静态资源 (直接复制到 dist/)
│   ├── logo.png                  # 应用 Logo
│   ├── favicon.ico               # 网站图标
│   └── assets/                   # 图片、字体等静态文件
│
├── electron/                     # Electron 桌面应用配置
│   ├── main.js                   # Electron 主进程
│   │                             # 作用: 创建窗口、系统集成、菜单
│   │
│   └── preload.js                # Electron 预加载脚本
│                                 # 作用: 安全地暴露 Node.js API 给渲染进程
│
├── dist/                         # 【构建输出】Vite 构建后的文件
│                                 # 生成: npm run build
│                                 # 内容: 压缩后的 HTML、CSS、JS
│
├── node_modules/                 # npm 依赖包 (约 1GB)
│
├── package.json                  # 【重要】npm 依赖配置
│                                 # 内容:
│                                 # - dependencies: 生产依赖 (React, Ant Design, Axios 等)
│                                 # - devDependencies: 开发依赖 (Vite, TypeScript, ESLint 等)
│                                 # - scripts: npm 脚本命令
│                                 #   - npm run dev: 开发服务器
│                                 #   - npm run build: 生产构建
│                                 #   - npm run preview: 预览构建结果
│
├── package-lock.json             # npm 依赖锁定文件 (确保版本一致)
│
├── vite.config.ts                # 【重要】Vite 构建配置
│                                 # 内容:
│                                 # - 插件配置 (React, Electron)
│                                 # - 代理配置 (开发时转发 API 到后端)
│                                 # - 构建优化 (代码分割、压缩)
│
├── tsconfig.json                 # 【重要】TypeScript 编译配置
│                                 # 内容:
│                                 # - 编译目标 (ES2020)
│                                 # - 模块系统 (ESNext)
│                                 # - 类型检查严格度
│                                 # - 路径别名 (@/ -> src/)
│
├── tsconfig.node.json            # Node.js 环境的 TypeScript 配置
│
├── .eslintrc.cjs                 # ESLint 代码规范配置
│                                 # 作用: 统一代码风格、检测错误
│
├── .prettierrc                   # Prettier 代码格式化配置
│
└── .gitignore                    # Git 忽略文件
                                  # 忽略: node_modules/, dist/, .env
```

### 3.3 前端核心工作流程

#### 3.3.1 应用启动流程

```
1. main.tsx (入口)
   ↓
2. App.tsx (主组件)
   ↓ 初始化
   - LanguageContext (多语言)
   - React Query (数据缓存)
   - React Router (路由)
   ↓
3. 检查认证状态 (localStorage 中的 token)
   ↓
4. 渲染布局 (Layout.tsx)
   - Navbar (顶部导航)
   - Sidebar (侧边栏)
   - 内容区域 (当前路由的页面)
```

#### 3.3.2 数据获取流程 (React Query)

```
1. 组件调用 Hook (如 useCards())
   ↓
2. React Query 检查缓存
   - 有缓存 → 立即返回缓存数据
   - 无缓存 → 发起 API 请求
   ↓
3. API 请求 (通过 utils/api.ts)
   - 自动添加 JWT Token (请求拦截器)
   ↓
4. 后端响应
   - 成功 → 缓存数据、返回组件
   - 401 错误 → 自动刷新 Token、重试
   - 其他错误 → 展示错误提示
   ↓
5. React Query 自动管理
   - 后台重新获取 (staleTime 后)
   - 自动重试失败请求
   - 自动垃圾回收
```

#### 3.3.3 认证流程

```
1. 用户访问登录页 (Login.tsx)
   ↓
2. 输入用户名/密码 或 点击 OAuth 登录
   ↓
3. 调用后端 API
   - /api/v1/auth/login (用户名密码)
   - /api/v1/oauth/{provider} (OAuth)
   ↓
4. 后端返回 JWT Token
   ↓
5. 前端存储 Token
   - localStorage.setItem('access_token', token)
   - localStorage.setItem('refresh_token', refreshToken)
   ↓
6. 跳转到首页
   ↓
7. 后续请求自动携带 Token (utils/api.ts 拦截器)
```

#### 3.3.4 多语言切换流程

```
1. 用户点击语言切换按钮 (Navbar.tsx)
   ↓
2. 调用 setLanguage('zh-CN' | 'en-US' | 'ja-JP')
   ↓
3. LanguageContext 更新状态
   ↓
4. 所有使用 t() 函数的组件自动重新渲染
   ↓
5. 从 translations.ts 获取对应语言的文本
```

### 3.4 前端关键文件详解

#### 3.4.1 `utils/api.ts` (最重要的文件之一)

```typescript
// 作用: 创建 Axios 实例、配置拦截器

import axios from 'axios';

// 创建 Axios 实例
const api = axios.create({
  baseURL: '/api/v1',  // 所有请求的基础 URL
  timeout: 10000,      // 请求超时时间
});

// 请求拦截器 (自动添加 Token)
api.interceptors.request.use((config) => {
  const token = localStorage.getItem('access_token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 响应拦截器 (处理错误)
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Token 过期，尝试刷新
      const refreshToken = localStorage.getItem('refresh_token');
      // ... 刷新逻辑
    }
    return Promise.reject(error);
  }
);

export default api;
```

#### 3.4.2 `contexts/LanguageContext.tsx` (多语言管理)

```typescript
// 作用: 提供全局多语言状态和翻译函数

import React, { createContext, useState, useContext } from 'react';
import translations from '../locales/translations';

type Language = 'zh-CN' | 'en-US' | 'ja-JP';

interface LanguageContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;  // 翻译函数
}

const LanguageContext = createContext<LanguageContextType | undefined>(undefined);

export const LanguageProvider: React.FC = ({ children }) => {
  const [language, setLanguage] = useState<Language>('zh-CN');

  const t = (key: string) => {
    return translations[key]?.[language] || key;
  };

  return (
    <LanguageContext.Provider value={{ language, setLanguage, t }}>
      {children}
    </LanguageContext.Provider>
  );
};

// Hook: 在组件中使用
export const useLanguage = () => {
  const context = useContext(LanguageContext);
  if (!context) throw new Error('useLanguage must be used within LanguageProvider');
  return context;
};
```

#### 3.4.3 `hooks/useCards.ts` (React Query 数据获取)

```typescript
// 作用: 封装技术卡片数据的获取逻辑

import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import api from '../utils/api';

// 获取卡片列表
export const useCards = (filters?: { source?: string; tags?: string[] }) => {
  return useQuery({
    queryKey: ['cards', filters],  // 缓存键 (包含过滤条件)
    queryFn: async () => {
      const response = await api.get('/cards', { params: filters });
      return response.data;
    },
    staleTime: 5 * 60 * 1000,  // 5分钟内数据被认为是新鲜的
    cacheTime: 10 * 60 * 1000, // 缓存保留10分钟
  });
};

// 获取单个卡片详情
export const useCardDetail = (cardId: number) => {
  return useQuery({
    queryKey: ['card', cardId],
    queryFn: async () => {
      const response = await api.get(`/cards/${cardId}`);
      return response.data;
    },
  });
};

// 创建新卡片 (Mutation)
export const useCreateCard = () => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: async (cardData: any) => {
      const response = await api.post('/cards', cardData);
      return response.data;
    },
    onSuccess: () => {
      // 创建成功后，使卡片列表缓存失效，触发重新获取
      queryClient.invalidateQueries({ queryKey: ['cards'] });
    },
  });
};
```

### 3.5 前端常用命令

```bash
# 安装依赖
npm install

# 启动开发服务器 (热重载)
npm run dev
# → 访问 http://localhost:5173

# 生产构建
npm run build
# → 输出到 dist/ 目录

# 预览构建结果
npm run preview

# 类型检查
npm run type-check

# 代码格式化
npm run format

# 代码检查
npm run lint
```

### 3.6 前端开发指南

#### 3.6.1 如何添加新页面

```typescript
// 1. 在 src/pages/ 创建新组件
// src/pages/NewPage.tsx
import React from 'react';
import { useLanguage } from '../contexts/LanguageContext';

const NewPage: React.FC = () => {
  const { t } = useLanguage();

  return (
    <div>
      <h1>{t('newPage.title')}</h1>
    </div>
  );
};

export default NewPage;

// 2. 在 App.tsx 添加路由
import NewPage from './pages/NewPage';

// 在 <Routes> 中添加:
<Route path="/new-page" element={<NewPage />} />

// 3. 在 locales/translations.ts 添加翻译
export const translations = {
  'newPage.title': {
    'zh-CN': '新页面',
    'en-US': 'New Page',
    'ja-JP': '新しいページ',
  },
};
```

#### 3.6.2 如何调用后端 API

```typescript
// 方法1: 直接使用 api.ts
import api from '../utils/api';

const fetchData = async () => {
  try {
    const response = await api.get('/cards');
    console.log(response.data);
  } catch (error) {
    console.error('API 错误:', error);
  }
};

// 方法2: 使用 React Query (推荐)
import { useQuery } from '@tanstack/react-query';
import api from '../utils/api';

const MyComponent = () => {
  const { data, isLoading, error } = useQuery({
    queryKey: ['myData'],
    queryFn: async () => {
      const response = await api.get('/cards');
      return response.data;
    },
  });

  if (isLoading) return <div>加载中...</div>;
  if (error) return <div>错误: {error.message}</div>;

  return <div>{JSON.stringify(data)}</div>;
};
```

#### 3.6.3 如何使用 Ant Design 组件

```typescript
import React from 'react';
import { Button, Card, Table, Input, Modal } from 'antd';

const MyComponent = () => {
  return (
    <div>
      {/* 按钮 */}
      <Button type="primary">主要按钮</Button>

      {/* 卡片 */}
      <Card title="标题" extra={<a href="#">更多</a>}>
        内容
      </Card>

      {/* 表格 */}
      <Table
        dataSource={[{ id: 1, name: '张三' }]}
        columns={[
          { title: 'ID', dataIndex: 'id' },
          { title: '姓名', dataIndex: 'name' },
        ]}
      />

      {/* 输入框 */}
      <Input placeholder="请输入" />

      {/* 模态框 */}
      <Modal title="标题" visible={true}>
        内容
      </Modal>
    </div>
  );
};
```

### 3.7 前端项目依赖 (package.json)

**核心依赖** (44+ 个包):

| 包名 | 版本 | 说明 |
|------|------|------|
| `react` | 18.2.0 | React 框架 |
| `react-dom` | 18.2.0 | React DOM 操作 |
| `react-router-dom` | 6.20.0 | 路由管理 |
| `antd` | 5.11.0 | UI 组件库 |
| `@tanstack/react-query` | 5.90.2 | 数据获取和缓存 |
| `zustand` | 4.4.6 | 轻量级状态管理 |
| `axios` | 1.6.2 | HTTP 客户端 |
| `echarts` | 5.6.0 | 图表库 |
| `@ant-design/charts` | 2.6.5 | Ant Design 图表 |
| `dayjs` | 1.11.10 | 日期处理 |
| `lodash` | 4.17.21 | 工具函数库 |
| `electron` | 27.0.0 | 桌面应用框架 |

**开发依赖**:

| 包名 | 版本 | 说明 |
|------|------|------|
| `vite` | 4.5.0 | 构建工具 |
| `typescript` | 5.2.2 | TypeScript 编译器 |
| `@vitejs/plugin-react` | 4.2.0 | Vite React 插件 |
| `eslint` | 8.54.0 | 代码检查 |
| `prettier` | 3.1.0 | 代码格式化 |

---

## 4. 其他目录

```
TechPulse/
├── docs/                       # 项目文档
│   ├── API文档.md              # 后端 API 接口文档
│   ├── 开发指南.md             # 开发者指南
│   ├── 部署指南.md             # 生产环境部署
│   └── 项目文件结构说明.md     # 本文档
│
├── scripts/                    # 项目脚本
│   └── start.sh                # 一键启动前后端
│
├── .github/                    # GitHub 配置
│   └── workflows/              # CI/CD 工作流
│       └── test.yml            # 自动化测试
│
├── .vscode/                    # VSCode 配置
│   ├── settings.json           # 编辑器设置
│   └── extensions.json         # 推荐扩展
│
├── .env.example                # 环境变量示例
├── .gitignore                  # Git 忽略文件
├── README.md                   # 项目介绍
└── LICENSE                     # 开源许可证
```

---

## 5. 快速开始

### 5.1 后端启动

```bash
cd backend

# 安装依赖
poetry install

# 运行数据库迁移
alembic upgrade head

# 启动后端
python run.py
# → 访问 http://localhost:8000
```

### 5.2 前端启动

```bash
cd frontend

# 安装依赖
npm install

# 启动前端
npm run dev
# → 访问 http://localhost:5173
```

### 5.3 一键启动 (推荐)

```bash
# 在项目根目录
./scripts/start.sh
```

---

## 6. 常见问题

### 6.1 前端问题

**Q: React Query 是什么? 为什么用它?**

A: React Query 是一个数据获取和缓存库。它的优势:
- 自动缓存数据 (减少不必要的 API 请求)
- 自动重新获取 (数据过期时)
- 自动错误重试
- 加载状态管理 (isLoading, error)
- 减少样板代码

**Q: Context API 和 Zustand 有什么区别?**

A:
- **Context API**: React 内置、适合简单的全局状态 (如多语言)
- **Zustand**: 第三方库、性能更好、适合复杂状态管理

**Q: Vite 和 Webpack 有什么区别?**

A:
- **Vite**: 更快的开发服务器 (ESM)、更快的热重载
- **Webpack**: 更成熟、生态更丰富、配置更复杂

**Q: 如何在组件中获取用户信息?**

A:
```typescript
const token = localStorage.getItem('access_token');
if (token) {
  // 已登录
  const user = JSON.parse(atob(token.split('.')[1])); // 解析 JWT
}
```

### 6.2 后端问题

**Q: 如何添加新的 API 端点?**

A:
```python
# 1. 在 app/api/ 创建新文件或编辑现有文件
# app/api/my_endpoint.py
from fastapi import APIRouter

router = APIRouter()

@router.get("/my-endpoint")
def my_endpoint():
    return {"message": "Hello"}

# 2. 在 app/main.py 注册路由
from app.api import my_endpoint
app.include_router(my_endpoint.router, prefix="/api/v1")
```

**Q: 如何运行测试?**

A:
```bash
cd backend
pytest  # 运行所有测试
pytest tests/unit  # 只运行单元测试
pytest tests/integration  # 只运行集成测试
```

---

## 7. 架构图

### 7.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                         用户浏览器                            │
│                    (React + TypeScript)                      │
└───────────────────────────┬─────────────────────────────────┘
                            │ HTTP/HTTPS
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                      后端 API 服务器                          │
│                      (FastAPI + Python)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │   认证层     │  │   业务层     │  │   数据层     │         │
│  │  (JWT/OAuth) │→│  (Services)  │→│  (SQLAlchemy)│         │
│  └─────────────┘  └─────────────┘  └──────┬──────┘         │
└────────────────────────────────────────────┼────────────────┘
                                             ↓
                                    ┌────────────────┐
                                    │  SQLite 数据库  │
                                    └────────────────┘
                                             ↑
                                             │
┌────────────────────────────────────────────┼────────────────┐
│                      数据采集层                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │  GitHub  │  │  Arxiv   │  │ HuggingFace│ │  Zenn    │   │
│  │  Scraper │  │  Scraper │  │  Scraper   │ │ Scraper  │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
│       ↑              ↑              ↑              ↑        │
│       └──────────────┴──────────────┴──────────────┘        │
│                   定时任务调度器 (6小时)                      │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 前端数据流

```
用户操作 → 组件 → Hook (useCards) → React Query
                                      ↓
                                  检查缓存
                                      ↓
                          有缓存?  是 → 返回缓存数据
                              ↓ 否
                          API 请求 (utils/api.ts)
                              ↓
                      添加 JWT Token (拦截器)
                              ↓
                          后端 API
                              ↓
                          响应处理
                              ↓
                      缓存数据 → 返回组件 → 渲染 UI
```

---

## 8. 附录

### 8.1 环境变量

**后端 (.env)**:
```env
# 数据库
DATABASE_URL=sqlite:///./techpulse.db

# JWT
JWT_SECRET_KEY=your-secret-key
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30

# Azure OpenAI
AZURE_OPENAI_API_KEY=xxx
AZURE_OPENAI_ENDPOINT=xxx

# GitHub
GITHUB_TOKEN=xxx

# OAuth
GOOGLE_CLIENT_ID=xxx
GOOGLE_CLIENT_SECRET=xxx
```

**前端 (.env)**:
```env
VITE_API_BASE_URL=http://localhost:8000
VITE_APP_NAME=TechPulse
```

### 8.2 推荐的 VSCode 扩展

- **前端**:
  - ESLint
  - Prettier
  - TypeScript Vue Plugin (Volar)
  - Auto Rename Tag
  - ES7+ React/Redux/React-Native snippets

- **后端**:
  - Python
  - Pylance
  - Python Test Explorer
  - autopep8

---

## 9. 总结

**后端特点**:
- 清晰的分层架构 (API层 → 服务层 → 模型层)
- 完整的认证系统 (JWT + OAuth2 + 2FA)
- 模块化的数据爬虫
- 充分的测试覆盖

**前端特点**:
- 现代化的 React 技术栈
- 企业级 UI 组件库 (Ant Design)
- 高效的数据缓存策略 (React Query)
- 完整的国际化支持 (中英日)
- 跨平台支持 (Web + Electron)

**开发建议**:
- 前端新手: 先从简单的组件开始 (如 `TechCard.tsx`)
- 熟悉 React Query 的工作原理 (查看 `hooks/useCards.ts`)
- 理解 `utils/api.ts` 的拦截器机制
- 多看 Ant Design 官方文档: https://ant.design/components/overview-cn/

**学习路径** (前端):
1. 理解 React 基础 (组件、Props、State、Hooks)
2. 学习 TypeScript 基础 (类型、接口、泛型)
3. 熟悉 React Router (路由配置)
4. 掌握 React Query (数据获取)
5. 了解 Ant Design (组件使用)

---

**文档维护**: 请在每次重大功能更新后更新本文档。

**作者**: TechPulse 团队
**联系**: techpulse@example.com
