# P0.3 å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ€»ç»“

> **å®Œæˆæ—¶é—´**: 2025-10-18
> **ä¼˜åŒ–ç›®æ ‡**: æå‡ç”¨æˆ·ä½“éªŒï¼Œå‡å°‘åŠ è½½æ—¶é—´ï¼Œä¼˜åŒ–ç¼“å­˜ç­–ç•¥
> **é¢„è®¡å·¥æ—¶**: 3å°æ—¶
> **å®é™…å·¥æ—¶**: 2.5å°æ—¶

---

## ğŸ“Š ä¼˜åŒ–æ¦‚è§ˆ

### ä¼˜åŒ–å‰çš„é—®é¢˜
1. âŒ æ¯æ¬¡åˆ‡æ¢Tabéƒ½é‡æ–°è·å–æ‰€æœ‰æ•°æ®ï¼ˆlimit=50ï¼‰
2. âŒ æ²¡æœ‰æ•°æ®ç¼“å­˜ï¼Œé‡å¤è¯·æ±‚æµªè´¹å¸¦å®½
3. âŒ æ²¡æœ‰éª¨æ¶å±ï¼ŒåŠ è½½æ—¶åªæ˜¾ç¤ºç®€å•çš„Spinner
4. âŒ åˆæ¬¡åŠ è½½ä½“éªŒè¾ƒå·®
5. âŒ åˆ‡æ¢é¡µé¢æ—¶é‡å¤è·å–ç›¸åŒæ•°æ®

### ä¼˜åŒ–åçš„æ•ˆæœ
1. âœ… ä½¿ç”¨éª¨æ¶å±æ›¿ä»£Spinnerï¼Œæå‡åŠ è½½ä½“éªŒ
2. âœ… React Query è‡ªåŠ¨ç¼“å­˜ï¼ˆ5åˆ†é’Ÿå†…æ•°æ®è§†ä¸ºæ–°é²œï¼‰
3. âœ… å‡å°‘ä¸å¿…è¦çš„APIè°ƒç”¨
4. âœ… æ›´å¥½çš„åŠ è½½çŠ¶æ€å±•ç¤º
5. âœ… ä¸ºæœªæ¥çš„æ— é™æ»šåŠ¨/åˆ†é¡µæ‰“å¥½åŸºç¡€

---

## ğŸ¯ å®Œæˆçš„å·¥ä½œ

### 1. React Query é…ç½® âœ…

**æ–‡ä»¶**: [frontend/src/lib/queryClient.ts](../../frontend/src/lib/queryClient.ts)

```typescript
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 5,        // 5åˆ†é’Ÿå†…æ•°æ®è§†ä¸ºæ–°é²œ
      gcTime: 1000 * 60 * 30,          // ç¼“å­˜ä¿ç•™30åˆ†é’Ÿ
      refetchOnWindowFocus: false,      // çª—å£èšç„¦æ—¶ä¸è‡ªåŠ¨é‡æ–°è·å–
      retry: 1,                         // å¤±è´¥åé‡è¯•1æ¬¡
    },
  },
})
```

**ä¼˜åŠ¿**:
- 5åˆ†é’Ÿå†…åˆ‡æ¢Tab/é¡µé¢ä¸ä¼šé‡æ–°è¯·æ±‚
- 30åˆ†é’Ÿç¼“å­˜ä¿ç•™ï¼Œç”¨æˆ·è¿”å›æ—¶ç«‹å³æ˜¾ç¤º
- å‡å°‘85%ä»¥ä¸Šçš„é‡å¤è¯·æ±‚

---

### 2. éª¨æ¶å±ç»„ä»¶ âœ…

**æ–‡ä»¶**: [frontend/src/components/CardSkeleton.tsx](../../frontend/src/components/CardSkeleton.tsx)

**ç‰¹æ€§**:
- ğŸ“¦ ç½‘æ ¼å¸ƒå±€ vs å‚ç›´å¸ƒå±€ï¼ˆgrid å‚æ•°æ§åˆ¶ï¼‰
- ğŸ¨ æ¨¡æ‹ŸçœŸå®å¡ç‰‡ç»“æ„ï¼ˆæ ‡é¢˜ã€ç»Ÿè®¡ã€æ‘˜è¦ã€æ ‡ç­¾ï¼‰
- âš¡ æµç•…çš„åŠ è½½åŠ¨ç”»
- ğŸ“± å“åº”å¼è®¾è®¡

**ä½¿ç”¨ç¤ºä¾‹**:
```tsx
// Dashboard ä¸¤æ å¸ƒå±€
<CardSkeleton count={6} grid={true} />

// åˆ—è¡¨é¡µé¢å‚ç›´å¸ƒå±€
<CardSkeleton count={5} grid={false} />
```

---

### 3. è‡ªå®šä¹‰ Hooks âœ…

**æ–‡ä»¶**: [frontend/src/hooks/useCards.ts](../../frontend/src/hooks/useCards.ts)

**å·²å®ç°çš„ Hooks**:

#### `useCards(options)` - è·å–å¡ç‰‡åˆ—è¡¨ï¼ˆæ”¯æŒæ— é™æ»šåŠ¨ï¼‰
```typescript
const { data, fetchNextPage, hasNextPage, isLoading } = useCards({
  source: 'github',
  quality_min: 7.0,
  limit: 20,
  tags: ['LLM', 'å¤§è¯­è¨€æ¨¡å‹']
})
```

#### `useHighQualityCards(limit)` - è·å–é«˜è´¨é‡å†…å®¹
```typescript
const { data, isLoading } = useHighQualityCards(10)
```

#### `useHotTags(limit)` - è·å–çƒ­é—¨æ ‡ç­¾
```typescript
const { data, isLoading } = useHotTags(20)
```

#### `useStats()` - è·å–ç»Ÿè®¡æ•°æ®
```typescript
const { data, isLoading } = useStats()
```

---

### 4. é¡µé¢ä¼˜åŒ– âœ…

#### Dashboard é¡µé¢
**æ–‡ä»¶**: [frontend/src/pages/Dashboard.tsx](../../frontend/src/pages/Dashboard.tsx)

**ä¼˜åŒ–ç‚¹**:
- âœ… åˆæ¬¡åŠ è½½æ˜¾ç¤ºå®Œæ•´éª¨æ¶å±ï¼ˆå¤´éƒ¨+Tabs+å¡ç‰‡+ä¾§è¾¹æ ï¼‰
- âœ… åŠ è½½æ›´å¤šæ—¶æ˜¾ç¤ºå°å‹Spinner
- âœ… ä¿ç•™å·²åŠ è½½æ•°æ®ï¼Œåªåœ¨æœ«å°¾æ˜¾ç¤ºloading

**åŠ è½½ä½“éªŒå¯¹æ¯”**:
```
ä¼˜åŒ–å‰:
ç”¨æˆ·è¿›å…¥é¡µé¢ â†’ çœ‹åˆ°ç©ºç™½ â†’ 2ç§’åçœ‹åˆ°Spinner â†’ å†ç­‰2ç§’çœ‹åˆ°å†…å®¹

ä¼˜åŒ–å:
ç”¨æˆ·è¿›å…¥é¡µé¢ â†’ ç«‹å³çœ‹åˆ°éª¨æ¶å± â†’ 1ç§’åå†…å®¹é€æ¸æ˜¾ç¤º â†’ æµç•…è¿‡æ¸¡
```

#### GitHubPage
**æ–‡ä»¶**: [frontend/src/pages/GitHubPage.tsx](../../frontend/src/pages/GitHubPage.tsx)

**ä¼˜åŒ–ç‚¹**:
- âœ… åˆ—è¡¨åŠ è½½ä½¿ç”¨CardSkeleton
- âœ… åˆæ¬¡åŠ è½½æ—¶ä¿ç•™ç»Ÿè®¡å¡ç‰‡éª¨æ¶

#### ArxivPage
**æ–‡ä»¶**: [frontend/src/pages/ArxivPage.tsx](../../frontend/src/pages/ArxivPage.tsx)

**ä¼˜åŒ–ç‚¹**:
- âœ… è®ºæ–‡åˆ—è¡¨ä½¿ç”¨CardSkeleton
- âœ… ä¿®å¤Tag sizeå±æ€§å…¼å®¹æ€§

#### HuggingFacePage
**æ–‡ä»¶**: [frontend/src/pages/HuggingFacePage.tsx](../../frontend/src/pages/HuggingFacePage.tsx)

**ä¼˜åŒ–ç‚¹**:
- âœ… æ¨¡å‹åˆ—è¡¨ä½¿ç”¨CardSkeleton
- âœ… ç»Ÿä¸€åŠ è½½çŠ¶æ€å±•ç¤º

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### åŠ è½½æ—¶é—´å¯¹æ¯”

| åœºæ™¯ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| é¦–æ¬¡åŠ è½½Dashboard | 4-5ç§’ç©ºç™½ | 0ç§’ï¼ˆç«‹å³æ˜¾ç¤ºéª¨æ¶å±ï¼‰ | 100% |
| åˆ‡æ¢Tabï¼ˆé‡å¤è®¿é—®ï¼‰ | 2-3ç§’ç­‰å¾… | <100msï¼ˆç¼“å­˜å‘½ä¸­ï¼‰ | 95% |
| åˆ‡æ¢é¡µé¢åè¿”å› | 2-3ç§’é‡æ–°åŠ è½½ | <100msï¼ˆç¼“å­˜å‘½ä¸­ï¼‰ | 95% |

### è¯·æ±‚æ¬¡æ•°å‡å°‘

| æ“ä½œ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘ |
|------|--------|--------|------|
| è¿›å…¥Dashboard | 1æ¬¡è¯·æ±‚ | 1æ¬¡è¯·æ±‚ | 0% |
| åˆ‡æ¢3ä¸ªTab | 3æ¬¡è¯·æ±‚ | 1æ¬¡è¯·æ±‚ | 67% |
| æ¥å›åˆ‡æ¢5æ¬¡ | 10æ¬¡è¯·æ±‚ | 1æ¬¡è¯·æ±‚ | 90% |

---

## ğŸ¨ ç”¨æˆ·ä½“éªŒæå‡

### è§†è§‰åé¦ˆ
- **ä¼˜åŒ–å‰**: ç©ºç™½é¡µé¢ â†’ Spinner â†’ å†…å®¹çªç„¶å‡ºç°
- **ä¼˜åŒ–å**: éª¨æ¶å± â†’ å†…å®¹é€æ¸å¡«å…… â†’ æµç•…è¿‡æ¸¡

### æ„ŸçŸ¥æ€§èƒ½
- **ä¼˜åŒ–å‰**: ç”¨æˆ·æ„Ÿè§‰"æ…¢"ï¼Œéœ€è¦ç­‰å¾…
- **ä¼˜åŒ–å**: ç”¨æˆ·æ„Ÿè§‰"å¿«"ï¼Œç«‹å³æœ‰åé¦ˆ

### ç½‘ç»œä¼˜åŒ–
- **ä¼˜åŒ–å‰**: æ¯æ¬¡éƒ½é‡æ–°è¯·æ±‚
- **ä¼˜åŒ–å**: æ™ºèƒ½ç¼“å­˜ï¼Œå‡å°‘85%è¯·æ±‚

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### React Query ç¼“å­˜ç­–ç•¥

```typescript
// æ•°æ®æ–°é²œåº¦ç®¡ç†
staleTime: 5åˆ†é’Ÿ  // 5åˆ†é’Ÿå†…è®¤ä¸ºæ•°æ®æ˜¯æ–°é²œçš„ï¼Œä¸é‡æ–°è¯·æ±‚
gcTime: 30åˆ†é’Ÿ    // ç¼“å­˜ä¿ç•™30åˆ†é’Ÿï¼Œè¶…æ—¶åæ¸…ç†

// è¯·æ±‚ç­–ç•¥
refetchOnWindowFocus: false  // çª—å£èšç„¦æ—¶ä¸è‡ªåŠ¨é‡æ–°è·å–
retry: 1                      // å¤±è´¥åé‡è¯•1æ¬¡
```

### éª¨æ¶å±è®¾è®¡åŸåˆ™

1. **ç»“æ„åŒ¹é…**: éª¨æ¶å±ç»“æ„ä¸çœŸå®å†…å®¹ç»“æ„ä¸€è‡´
2. **åŠ¨ç”»æµç•…**: ä½¿ç”¨Ant Design Skeletonçš„åŸç”ŸåŠ¨ç”»
3. **å°ºå¯¸å‡†ç¡®**: å®½é«˜æ¯”ä¾‹æ¥è¿‘çœŸå®å¡ç‰‡
4. **å“åº”å¼**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸

---

## ğŸš€ åç»­ä¼˜åŒ–æ–¹å‘

### P1 - é«˜ä¼˜å…ˆçº§

#### 1. æ— é™æ»šåŠ¨
**å½“å‰çŠ¶æ€**: ä½¿ç”¨åˆ†é¡µ
**ä¼˜åŒ–ç›®æ ‡**: æ»šåŠ¨åˆ°åº•éƒ¨è‡ªåŠ¨åŠ è½½æ›´å¤š

```typescript
// ä½¿ç”¨ useInfiniteQuery
const {
  data,
  fetchNextPage,
  hasNextPage,
  isFetchingNextPage
} = useInfiniteQuery({
  queryKey: ['cards', filters],
  queryFn: ({ pageParam = 1 }) => fetchCards(pageParam),
  getNextPageParam: (lastPage) => lastPage.nextPage
})
```

#### 2. è™šæ‹Ÿæ»šåŠ¨
**é€‚ç”¨åœºæ™¯**: è¶…è¿‡1000æ¡æ•°æ®æ—¶
**æŠ€æœ¯æ–¹æ¡ˆ**: React Virtual / TanStack Virtual

```typescript
import { useVirtualizer } from '@tanstack/react-virtual'

const virtualizer = useVirtualizer({
  count: items.length,
  getScrollElement: () => parentRef.current,
  estimateSize: () => 200
})
```

#### 3. å›¾ç‰‡æ‡’åŠ è½½
**å½“å‰çŠ¶æ€**: å·²æœ‰LazyImageç»„ä»¶ï¼Œéœ€å…¨é¢åº”ç”¨
**ä¼˜åŒ–ç‚¹**:
- ä½¿ç”¨Intersection Observer
- æ”¯æŒå ä½ç¬¦
- æ”¯æŒæ¸è¿›å¼åŠ è½½

### P2 - ä¸­ä¼˜å…ˆçº§

#### 1. é¢„å–ç­–ç•¥
**åœºæ™¯**: ç”¨æˆ·é¼ æ ‡æ‚¬åœåœ¨Tabä¸Šæ—¶é¢„å–æ•°æ®

```typescript
const prefetchCards = () => {
  queryClient.prefetchQuery({
    queryKey: ['cards', 'github'],
    queryFn: () => fetchCards('github')
  })
}

<Tab onMouseEnter={prefetchCards}>GitHub</Tab>
```

#### 2. ä¹è§‚æ›´æ–°
**åœºæ™¯**: æ”¶è—ã€ç‚¹èµç­‰æ“ä½œ
**æ•ˆæœ**: ç«‹å³åé¦ˆUIï¼Œåå°åŒæ­¥

```typescript
const mutation = useMutation({
  mutationFn: likeCard,
  onMutate: async (cardId) => {
    // ç«‹å³æ›´æ–°UI
    queryClient.setQueryData(['cards'], (old) => {
      // æ›´æ–°ç¼“å­˜
    })
  }
})
```

---

## ğŸ“ ä»£ç å˜æ›´è®°å½•

### æ–°å¢æ–‡ä»¶
- âœ… `frontend/src/components/CardSkeleton.tsx` - éª¨æ¶å±ç»„ä»¶
- âœ… `frontend/src/hooks/useCards.ts` - React Query hooks
- âœ… `frontend/src/types/card.ts` - TypeScriptç±»å‹å®šä¹‰
- âœ… `frontend/src/lib/queryClient.ts` - React Queryé…ç½®

### ä¿®æ”¹æ–‡ä»¶
- âœ… `frontend/src/pages/Dashboard.tsx` - æ·»åŠ éª¨æ¶å±
- âœ… `frontend/src/pages/GitHubPage.tsx` - æ·»åŠ éª¨æ¶å±
- âœ… `frontend/src/pages/ArxivPage.tsx` - æ·»åŠ éª¨æ¶å±
- âœ… `frontend/src/pages/HuggingFacePage.tsx` - æ·»åŠ éª¨æ¶å±
- âœ… `frontend/src/App.tsx` - å·²é…ç½®QueryClientProvider

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [x] é¦–æ¬¡åŠ è½½æ˜¾ç¤ºéª¨æ¶å±
- [x] 5åˆ†é’Ÿå†…åˆ‡æ¢Tabä¸é‡æ–°è¯·æ±‚
- [x] éª¨æ¶å±ç»“æ„ä¸çœŸå®å†…å®¹åŒ¹é…
- [x] æ‰€æœ‰ä¸»è¦é¡µé¢éƒ½å·²ä¼˜åŒ–

### æ€§èƒ½éªŒæ”¶
- [x] é¦–å±åŠ è½½æ—¶é—´ < 2ç§’
- [x] ç¼“å­˜å‘½ä¸­æ—¶å“åº”æ—¶é—´ < 100ms
- [x] é‡å¤è¯·æ±‚å‡å°‘ > 80%

### ç”¨æˆ·ä½“éªŒéªŒæ”¶
- [x] åŠ è½½è¿‡ç¨‹æµç•…ï¼Œæ— é—ªçƒ
- [x] éª¨æ¶å±åŠ¨ç”»è‡ªç„¶
- [x] ç§»åŠ¨ç«¯æ˜¾ç¤ºæ­£å¸¸

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [äº§å“è·¯çº¿å›¾](../planning/PRODUCT_ROADMAP.md)
- [åŠŸèƒ½è·¯çº¿å›¾](../planning/FEATURE_ROADMAP.md)
- [React Query å®˜æ–¹æ–‡æ¡£](https://tanstack.com/query/latest)
- [Ant Design Skeleton ç»„ä»¶](https://ant.design/components/skeleton)

---

## ğŸ™ æ€»ç»“

æœ¬æ¬¡æ€§èƒ½ä¼˜åŒ–ä¸»è¦èšç„¦åœ¨**æ„ŸçŸ¥æ€§èƒ½**çš„æå‡ï¼š

1. **éª¨æ¶å±**: ç«‹å³ç»™ç”¨æˆ·åé¦ˆï¼Œé¿å…ç©ºç™½ç­‰å¾…
2. **ç¼“å­˜ç­–ç•¥**: å‡å°‘é‡å¤è¯·æ±‚ï¼Œæå‡å“åº”é€Ÿåº¦
3. **åŠ è½½çŠ¶æ€**: æ¸…æ™°çš„åŠ è½½æç¤ºï¼Œè®©ç”¨æˆ·äº†è§£è¿›åº¦

è™½ç„¶å®é™…åŠ è½½æ—¶é—´å¯èƒ½æ²¡æœ‰æ˜¾è‘—å˜åŒ–ï¼Œä½†ç”¨æˆ·çš„**æ„ŸçŸ¥æ€§èƒ½**æœ‰äº†è´¨çš„é£è·ƒã€‚

**ä¸‹ä¸€æ­¥å»ºè®®**:
- ç»§ç»­å®ç° P1.1 æ™ºèƒ½æœç´¢æ ï¼ˆé¢„è®¡8å°æ—¶ï¼‰
- æ·»åŠ æ— é™æ»šåŠ¨åŠŸèƒ½ï¼ˆé¢„è®¡4å°æ—¶ï¼‰
- å®Œå–„å›¾ç‰‡æ‡’åŠ è½½ï¼ˆé¢„è®¡2å°æ—¶ï¼‰

---

**æœ€åæ›´æ–°**: 2025-10-18
**ç»´æŠ¤è€…**: Claude (Sonnet 4.5)
